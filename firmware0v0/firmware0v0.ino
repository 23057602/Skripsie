//v0 is a dev flow & bluetooth test
//Includes////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
#include "BluetoothA2DPSink.h"

/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//Global variables
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//Bluetooth variables///////////////////////////////////////////////
BluetoothA2DPSink a2dp_sink;
const char*  bt_name = "IHopeIWork2";
bool auto_reconnect = false;
int16_t* bt_rx_buf;
uint32_t bt_rx_buf_len;
bool bt_isPlaying = false;

//IO variables//////////////////////////////////////////////////////
//int playPause_pin;

////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//Functions
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//Bluetooth functions///////////////////////////////////////////////
void read_data_stream(const uint8_t *data, uint32_t length) {
  bt_rx_buf = (int16_t*) data;
  bt_rx_buf_len = length/2;
}

void avrc_status(esp_avrc_playback_stat_t playback){
  bt_isPlaying = (bool)(a2dp_sink.to_str(playback) == "playing");
  Serial.print(bt_isPlaying);
  Serial.print(" : ");
  Serial.println(a2dp_sink.to_str(playback));
}

//Main Program///////////////////////////////////////////////////////
void setup() {
  // put your setup code here, to run once:
  Serial.begin(115200);
  a2dp_sink.set_stream_reader(read_data_stream, false);
  a2dp_sink.set_avrc_rn_playstatus_callback(avrc_status);
  a2dp_sink.start(bt_name, auto_reconnect);
}

void loop() {
  // put your main code here, to run repeatedly:
  

}
